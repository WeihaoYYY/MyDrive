import{k as se,r as c,ah as f,o as u,c as p,V as t,P as o,a3 as ie,T as m,U as T,F as H,O,S as y,n as Z,b as we,a as i,a9 as oe,J as ke,u as be,bm as Fe,bk as Ce}from"./@vue-600f7d09.js";import{u as Ne}from"./vue-clipboard3-abb1cd37.js";import{u as Ie,b as Te}from"./vue-router-383033d3.js";import{_ as xe}from"./index-5c738a66.js";import"./clipboard-2fdbe17c.js";import"./aplayer-d80f7f58.js";import"./element-plus-fba9d43f.js";import"./lodash-es-2e98bc53.js";import"./@vueuse-c43c5ddb.js";import"./@element-plus-4fa4826e.js";import"./@popperjs-c75af06c.js";import"./@ctrl-f8748455.js";import"./dayjs-7b3af433.js";import"./async-validator-10c6301d.js";import"./memoize-one-297ddbcb.js";import"./normalize-wheel-es-ed76fb12.js";import"./@floating-ui-fc8420ed.js";import"./vue-cookies-b2ef00ed.js";import"./@highlightjs-9bfede93.js";import"./highlight.js-07971b4d.js";import"./axios-9cbf0d09.js";import"./docx-preview-30c6d22b.js";import"./jszip-d9c085e9.js";import"./xlsx-04f2268f.js";import"./vue-pdf-embed-4c1bbf4d.js";import"./vue-373d10b3.js";import"./dplayer-ff9c2365.js";const Se={all:{accept:"*"},video:{accept:".mp4,.avi,.rmvb,.mkv,.mov"},music:{accept:".mp3,.wav,.wma,.mp2,.flac,.midi,.ra,.ape,.aac,.cda"},image:{accept:".jpeg,.jpg,.png,.gif,.bmp,.dds,.psd,.pdt,.webp,.xmp,.svg,.tiff"},doc:{accept:".pdf,.doc,.docx,.xls,.xlsx,.txt"},others:{accept:"*"}},Re={__name:"ShareFile",setup(V,{expose:J}){const{toClipboard:G}=Ne(),{proxy:r}=se(),z=c(document.location.origin+"/share/"),P={shareFile:"/share/shareFile"},U=c(0),d=c({}),v=c(),q={validType:[{required:!0,message:"请选择有效期"}],codeType:[{required:!0,message:"请选择提取码类型"}],code:[{required:!0,message:"请输入提取码"},{validator:r.Verify.shareCode,message:"提取码只能是数字字母"},{min:5,message:"提取码最少5位"}]},D=c(!0),k=c({show:!1,title:"分享",buttons:[{type:"primary",text:"确定",click:g=>{Q()}}]}),s=c({}),Q=async()=>{if(Object.keys(s.value).length>0){k.value.show=!1;return}v.value.validate(async g=>{if(!g)return;let n={};Object.assign(n,d.value);let _=await r.Request({url:P.shareFile,params:n});_&&(U.value=1,s.value=_.data,k.value.buttons[0].text="关闭",D.value=!1)})};J({show:g=>{D.value=!0,k.value.show=!0,U.value=0,s.value={},Z(()=>{v.value.resetFields(),d.value=Object.assign({},g)})}});const S=async()=>{await G(`链接:${z.value}${s.value.shareId} 提取码: ${s.value.code}`),r.Message.success("复制成功")};return(g,n)=>{const _=f("el-form-item"),F=f("el-radio"),b=f("el-radio-group"),$=f("el-input"),j=f("el-button"),W=f("el-form"),B=f("Dialog");return u(),p("div",null,[t(B,{show:k.value.show,title:k.value.title,buttons:k.value.buttons,width:"600px",showCancel:D.value,onClose:n[4]||(n[4]=C=>k.value.show=!1)},{default:o(()=>[t(W,{model:d.value,rules:q,ref_key:"formDataRef",ref:v,"label-width":"100px",onSubmit:n[3]||(n[3]=ie(()=>{},["prevent"]))},{default:o(()=>[t(_,{label:"文件"},{default:o(()=>[m(T(d.value.fileName),1)]),_:1}),U.value==0?(u(),p(H,{key:0},[t(_,{label:"有效期",prop:"validType"},{default:o(()=>[t(b,{modelValue:d.value.validType,"onUpdate:modelValue":n[0]||(n[0]=C=>d.value.validType=C)},{default:o(()=>[t(F,{label:0},{default:o(()=>[m("1天")]),_:1}),t(F,{label:1},{default:o(()=>[m("7天")]),_:1}),t(F,{label:2},{default:o(()=>[m("30天")]),_:1}),t(F,{label:3},{default:o(()=>[m("永久有效")]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(_,{label:"提取码",prop:"codeType"},{default:o(()=>[t(b,{modelValue:d.value.codeType,"onUpdate:modelValue":n[1]||(n[1]=C=>d.value.codeType=C)},{default:o(()=>[t(F,{label:0},{default:o(()=>[m("自定义")]),_:1}),t(F,{label:1},{default:o(()=>[m("系统生成")]),_:1})]),_:1},8,["modelValue"])]),_:1}),d.value.codeType==0?(u(),O(_,{key:0,prop:"code"},{default:o(()=>[t($,{clearable:"",placeholder:"请输入5位提取码",modelValue:d.value.code,"onUpdate:modelValue":n[2]||(n[2]=C=>d.value.code=C),modelModifiers:{trim:!0},maxLength:"5",style:{width:"130px"}},null,8,["modelValue"])]),_:1})):y("",!0)],64)):(u(),p(H,{key:1},[t(_,{label:"分享连接"},{default:o(()=>[m(T(z.value)+T(s.value.shareId),1)]),_:1}),t(_,{label:"提取码"},{default:o(()=>[m(T(s.value.code),1)]),_:1}),t(_,null,{default:o(()=>[t(j,{type:"primary",onClick:S},{default:o(()=>[m("复制链接及提取码")]),_:1})]),_:1})],64))]),_:1},8,["model"])]),_:1},8,["show","title","buttons","showCancel"])])}}};const x=V=>(Fe("data-v-1a1d1f66"),V=V(),Ce(),V),Ve={class:"top"},De={class:"top-op"},$e={class:"btn"},Ee=x(()=>i("span",{class:"iconfont icon-upload"},null,-1)),Me=x(()=>i("span",{class:"iconfont icon-folder-add"},null,-1)),Oe=x(()=>i("span",{class:"iconfont icon-del"},null,-1)),ze=x(()=>i("span",{class:"iconfont icon-move"},null,-1)),Pe={class:"search-panel"},Ue={key:0,class:"file-list"},qe=["onMouseenter","onMouseleave"],Le=["title"],je=["onClick"],Be={key:0,class:"transfer-status"},Ke={key:1,class:"transfer-status transfer-fail"},Ae={key:3,class:"edit-panel"},He=["onClick"],Je=["onClick"],Ge={class:"op"},Qe=["onClick"],We=["onClick"],Xe=["onClick"],Ye=["onClick"],Ze=["onClick"],el={key:0},ll={key:1,class:"no-data"},tl={class:"no-data-inner"},al=x(()=>i("div",{class:"tips"},"当前目录为空，上传你的第一个文件吧",-1)),ol={class:"op-list"},sl={class:"op-item"},il=x(()=>i("div",null,"上传文件",-1)),nl=x(()=>i("div",null,"新建目录",-1)),cl={__name:"Main",emits:["addFile"],setup(V,{expose:J,emit:G}){const{proxy:r}=se();Ie(),Te();const z=G,P=async e=>{z("addFile",{file:e.file,filePid:d.value.fileId})};J({reload:()=>{S.value=!1,n()}});const d=c({fileId:0}),v={loadDataList:"/file/loadDataList",rename:"/file/rename",newFoloder:"/file/newFoloder",getFolderInfo:"/file/getFolderInfo",delFile:"/file/delFile",changeFileFolder:"/file/changeFileFolder",createDownloadUrl:"/file/createDownloadUrl",download:"/api/file/download"},q=we(()=>{const e=Se[g.value];return e?e.accept:"*"}),D=[{label:"文件名",prop:"fileName",scopedSlots:"fileName"},{label:"修改时间",prop:"lastUpdateTime",width:200},{label:"大小",prop:"fileSize",scopedSlots:"fileSize",width:200}],k=()=>{S.value=!0,n()},s=c({}),Q={extHeight:50,selectType:"checkbox"},L=c(),S=c(!0),g=c(),n=async()=>{let e={pageNo:s.value.pageNo,pageSize:s.value.pageSize,fileNameFuzzy:L.value,category:g.value,filePid:d.value.fileId};e.category!=="all"&&delete e.filePid;let l=await r.Request({url:v.loadDataList,showLoading:S,params:e});l&&(s.value=l.data,b.value=!1)},_=e=>{s.value.list.forEach(l=>{l.showOp=!1}),e.showOp=!0},F=e=>{e.showOp=!1},b=c(!1),$=c(),j=()=>{b.value||(s.value.list.forEach(e=>{e.showEdit=!1}),b.value=!0,s.value.list.unshift({showEdit:!0,fileType:0,fileId:"",filePid:d.value.fileId}),Z(()=>{$.value.focus()}))},W=e=>{const l=s.value.list[e];l.fileId?l.showEdit=!1:s.value.list.splice(e,1),b.value=!1},B=async e=>{const{fileId:l,filePid:w,fileNameReal:R}=s.value.list[e];if(R==""||R.indexOf("/")!=-1){r.Message.warning("文件名不能为空且不能含有斜杠");return}let M=v.rename;l==""&&(M=v.newFoloder);let A=await r.Request({url:M,params:{fileId:l,filePid:w,fileName:R}});A&&(s.value.list[e]=A.data,b.value=!1)},C=e=>{s.value.list[0].fileId==""&&(s.value.list.splice(0,1),e=e-1),s.value.list.forEach(w=>{w.showEdit=!1});let l=s.value.list[e];l.showEdit=!0,l.folderType==0?(l.fileNameReal=l.fileName.substring(0,l.fileName.indexOf(".")),l.fileSuffix=l.fileName.substring(l.fileName.indexOf("."))):(l.fileNameReal=l.fileName,l.fileSuffix=""),b.value=!0,Z(()=>{$.value.focus()})},N=c([]),ee=c([]),ne=e=>{ee.value=e,N.value=[],e.forEach(l=>{N.value.push(l.fileId)})},ce=e=>{r.Confirm(`你确定要删除【${e.fileName}】吗？删除的文件可在10天内通过回收站还原`,async()=>{await r.Request({url:v.delFile,params:{fileIds:e.fileId}})&&n()})},ue=()=>{N.value.length!=0&&r.Confirm("你确定要删除这些文件吗？删除的文件可在10天内通过回收站还原",async()=>{await r.Request({url:v.delFile,params:{fileIds:N.value.join(",")}})&&n()})},K=c(),E=c({}),de=e=>{E.value=e,K.value.showFolderDialog(e.fileId)},re=()=>{E.value={};const e=[d.value.fileId];ee.value.forEach(l=>{l.folderType==1&&e.push(l.fileId)}),K.value.showFolderDialog(e.join(","))},fe=async e=>{if(E.value.filePid===e||d.value.fileId==e){r.Message.warning("文件正在当前目录，无需移动");return}let l=[];E.value.fileId?l.push(E.value.fileId):l=l.concat(N.value),await r.Request({url:v.changeFileFolder,params:{fileIds:l.join(","),filePid:e}})&&(K.value.close(),n())},le=c(),te=c(),pe=e=>{if(e.folderType==1){te.value.openFolder(e);return}if(e.status!=2){r.Message.warning("文件正在转码中，无法预览");return}le.value.showPreview(e,0)},me=e=>{const{curFolder:l,categoryId:w}=e;d.value=l,S.value=!0,g.value=w,n()},ve=async e=>{let l=await r.Request({url:v.createDownloadUrl+"/"+e.fileId});l&&(window.location.href=v.download+"/"+l.data)},ae=c(),_e=e=>{ae.value.show(e)};return(e,l)=>{const w=f("el-button"),R=f("el-upload"),M=f("el-input"),A=f("Navigation"),X=f("icon"),he=f("Table"),Y=f("Icon"),ye=f("Preview"),ge=f("FolderSelect");return u(),p("div",null,[i("div",Ve,[i("div",De,[i("div",$e,[t(R,{"show-file-list":!1,"with-credentials":!0,multiple:!0,"http-request":P,accept:q.value},{default:o(()=>[t(w,{type:"primary"},{default:o(()=>[Ee,m(" 上传 ")]),_:1})]),_:1},8,["accept"])]),g.value=="all"?(u(),O(w,{key:0,type:"success",onClick:j},{default:o(()=>[Me,m(" 新建文件夹 ")]),_:1})):y("",!0),t(w,{onClick:ue,type:"danger",disabled:N.value.length==0},{default:o(()=>[Oe,m(" 批量删除 ")]),_:1},8,["disabled"]),t(w,{onClick:re,type:"warning",disabled:N.value.length==0},{default:o(()=>[ze,m(" 批量移动 ")]),_:1},8,["disabled"]),i("div",Pe,[t(M,{clearable:"",placeholder:"输入文件名搜索",modelValue:L.value,"onUpdate:modelValue":l[0]||(l[0]=I=>L.value=I),onKeyup:oe(k,["enter"])},{suffix:o(()=>[i("i",{class:"iconfont icon-search",onClick:k})]),_:1},8,["modelValue"])]),i("div",{class:"iconfont icon-refresh",onClick:n})]),t(A,{ref_key:"navigationRef",ref:te,onNavChange:me},null,512)]),s.value.list&&s.value.list.length>0?(u(),p("div",Ue,[t(he,{ref:"dataTableRef",columns:D,showPagination:!0,dataSource:s.value,fetch:n,initFetch:!1,options:Q,onRowSelected:ne},{fileName:o(({index:I,row:a})=>[i("div",{class:"file-item",onMouseenter:h=>_(a),onMouseleave:h=>F(a)},[(a.fileType==3||a.fileType==1)&&a.status==2?(u(),O(X,{key:0,cover:a.fileCover,width:32},null,8,["cover"])):(u(),p(H,{key:1},[a.folderType==0?(u(),O(X,{key:0,fileType:a.fileType},null,8,["fileType"])):y("",!0),a.folderType==1?(u(),O(X,{key:1,fileType:0})):y("",!0)],64)),a.showEdit?y("",!0):(u(),p("span",{key:2,class:"file-name",title:a.fileName},[i("span",{onClick:h=>pe(a)},T(a.fileName),9,je),a.status==0?(u(),p("span",Be,"转码中")):y("",!0),a.status==1?(u(),p("span",Ke,"转码失败")):y("",!0)],8,Le)),a.showEdit?(u(),p("div",Ae,[t(M,{modelValue:a.fileNameReal,"onUpdate:modelValue":h=>a.fileNameReal=h,modelModifiers:{trim:!0},ref_key:"editNameRef",ref:$,maxLength:190,onKeyup:oe(h=>B(I),["enter"])},{suffix:o(()=>[m(T(a.fileSuffix),1)]),_:2},1032,["modelValue","onUpdate:modelValue","onKeyup"]),i("span",{class:ke(["iconfont icon-right1",a.fileNameReal?"":"not-allow"]),onClick:h=>B(I)},null,10,He),i("span",{class:"iconfont icon-error",onClick:h=>W(I)},null,8,Je)])):y("",!0),i("span",Ge,[a.showOp&&a.fileId&&a.status==2?(u(),p(H,{key:0},[i("span",{class:"iconfont icon-share1",onClick:h=>_e(a)},"分享",8,Qe),a.folderType==0?(u(),p("span",{key:0,class:"iconfont icon-download",onClick:h=>ve(a)},"下载",8,We)):y("",!0),i("span",{class:"iconfont icon-del",onClick:h=>ce(a)},"删除",8,Xe),i("span",{class:"iconfont icon-edit",onClick:ie(h=>C(I),["stop"])},"重命名",8,Ye),i("span",{class:"iconfont icon-move",onClick:h=>de(a)},"移动",8,Ze)],64)):y("",!0)])],40,qe)]),fileSize:o(({index:I,row:a})=>[a.fileSize?(u(),p("span",el,T(be(r).Utils.size2Str(a.fileSize)),1)):y("",!0)]),_:1},8,["dataSource"])])):(u(),p("div",ll,[i("div",tl,[t(Y,{iconName:"no_data",width:120,fit:"fill"}),al,i("div",ol,[t(R,{"show-file-list":!1,"with-credentials":!0,multiple:!0,"http-request":P,accept:q.value},{default:o(()=>[i("div",sl,[t(Y,{iconName:"file",width:60}),il])]),_:1},8,["accept"]),g.value=="all"?(u(),p("div",{key:0,class:"op-item",onClick:j},[t(Y,{iconName:"folder",width:60}),nl])):y("",!0)])])])),t(ye,{ref_key:"previewRef",ref:le},null,512),t(ge,{ref_key:"folderSelectRef",ref:K,onFolderSelect:fe},null,512),t(Re,{ref_key:"shareRef",ref:ae},null,512)])}}},Ol=xe(cl,[["__scopeId","data-v-1a1d1f66"]]);export{Ol as default};
