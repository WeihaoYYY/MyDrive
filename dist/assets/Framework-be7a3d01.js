import{k as O,r as _,ah as v,o as n,c as p,a as t,F as E,V as i,P as d,T as G,a3 as Y,U as D,n as Z,a8 as H,O as T,S as N,J as j,K as X,u as J,bm as ee,bk as te,w as ie,R as ue}from"./@vue-600f7d09.js";import{u as K,b as Q}from"./vue-router-383033d3.js";import{S as ce}from"./spark-md5-18b273be.js";import{_ as se}from"./index-5c738a66.js";import"./aplayer-d80f7f58.js";import"./element-plus-fba9d43f.js";import"./lodash-es-2e98bc53.js";import"./@vueuse-c43c5ddb.js";import"./@element-plus-4fa4826e.js";import"./@popperjs-c75af06c.js";import"./@ctrl-f8748455.js";import"./dayjs-7b3af433.js";import"./async-validator-10c6301d.js";import"./memoize-one-297ddbcb.js";import"./normalize-wheel-es-ed76fb12.js";import"./@floating-ui-fc8420ed.js";import"./vue-cookies-b2ef00ed.js";import"./@highlightjs-9bfede93.js";import"./highlight.js-07971b4d.js";import"./axios-9cbf0d09.js";import"./docx-preview-30c6d22b.js";import"./jszip-d9c085e9.js";import"./xlsx-04f2268f.js";import"./vue-pdf-embed-4c1bbf4d.js";import"./vue-373d10b3.js";import"./dplayer-ff9c2365.js";import"./vue-clipboard3-abb1cd37.js";import"./clipboard-2fdbe17c.js";const de={class:"avatar-upload"},pe={class:"avatar-show"},_e=["src"],me=["src"],ve=["src"],fe={class:"select-btn"},he={__name:"AvatarUpload",props:{modelValue:{type:Object,default:null}},setup(h,{emit:w}){O(),K(),Q(),_("");const U=_(null),F=w,f=async e=>{e=e.file;let g=new FileReader;g.readAsDataURL(e),g.onload=({target:R})=>{U.value=R.result},F("update:modelValue",e)};return(e,g)=>{const R=v("el-button"),P=v("el-upload");return n(),p("div",de,[t("div",pe,[U.value?(n(),p("img",{key:0,src:U.value},null,8,_e)):(n(),p(E,{key:1},[h.modelValue&&h.modelValue.qqAvatar?(n(),p("img",{key:0,src:`${h.modelValue.qqAvatar}`},null,8,me)):(n(),p("img",{key:1,src:`/api/getAvatar/${h.modelValue.userId}`},null,8,ve))],64))]),t("div",fe,[i(P,{name:"file","show-file-list":!1,accept:".png,.PNG,.jpg,.JPG,.jpeg,.JPEG,.gif,.GIF,.bmp,.BMP",multiple:!1,"http-request":f},{default:d(()=>[i(R,{type:"primary"},{default:d(()=>[G("选择")]),_:1})]),_:1})])])}}},we={__name:"UpdateAvatar",emits:["updateAvatar"],setup(h,{expose:w,emit:U}){const{proxy:F}=O();K(),Q();const f={updateUserAvatar:"updateUserAvatar"},e=_({}),g=_();w({show:u=>{e.value=Object.assign({},u),e.value.avatar={userId:u.userId,qqAvatar:u.avatar},P.value.show=!0}});const P=_({show:!1,title:"修改头像",buttons:[{type:"primary",text:"确定",click:u=>{L()}}]}),V=U,L=async()=>{if(!(e.value.avatar instanceof File)){P.value.show=!1;return}if(!await F.Request({url:f.updateUserAvatar,params:{avatar:e.value.avatar}}))return;P.value.show=!1;const r=F.VueCookies.get("userInfo");delete r.avatar,F.VueCookies.set("userInfo",r,0),V("updateAvatar")};return(u,r)=>{const m=v("el-form-item"),M=v("el-form"),A=v("Dialog");return n(),p("div",null,[i(A,{show:P.value.show,title:P.value.title,buttons:P.value.buttons,width:"500px",showCancel:!0,onClose:r[2]||(r[2]=o=>P.value.show=!1)},{default:d(()=>[i(M,{model:e.value,ref_key:"formDataRef",ref:g,"label-width":"80px",onSubmit:r[1]||(r[1]=Y(()=>{},["prevent"]))},{default:d(()=>[i(m,{label:"昵称",prop:""},{default:d(()=>[G(D(e.value.nickName),1)]),_:1}),i(m,{label:"头像",prop:""},{default:d(()=>[i(he,{modelValue:e.value.avatar,"onUpdate:modelValue":r[0]||(r[0]=o=>e.value.avatar=o)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title","buttons"])])}}},ge=t("span",{class:"iconfont icon-password"},null,-1),ke=t("span",{class:"iconfont icon-password"},null,-1),ye={__name:"UpdatePassword",setup(h,{expose:w}){const{proxy:U}=O(),F={updatePassword:"updatePassword"},f=_({}),e=_(),g=(u,r,m)=>{r!==f.value.password?m(new Error(u.message)):m()},R={password:[{required:!0,message:"请输入密码"},{validator:U.Verify.password,message:"密码只能是数字，字母，特殊字符 8-18位"}],rePassword:[{required:!0,message:"请再次输入密码"},{validator:g,message:"两次输入的密码不一致"}]};w({show:()=>{V.value.show=!0,Z(()=>{e.value.resetFields(),f.value={}})}});const V=_({show:!1,title:"修改密码",buttons:[{type:"primary",text:"确定",click:u=>{L()}}]}),L=async()=>{e.value.validate(async u=>{!u||!await U.Request({url:F.updatePassword,params:{password:f.value.password}})||(V.value.show=!1,U.Message.success("密码修改成功"))})};return(u,r)=>{const m=v("el-input"),M=v("el-form-item"),A=v("el-form"),o=v("Dialog");return n(),p("div",null,[i(o,{show:V.value.show,title:V.value.title,buttons:V.value.buttons,width:"500px",showCancel:!0,onClose:r[3]||(r[3]=l=>V.value.show=!1)},{default:d(()=>[i(A,{model:f.value,rules:R,ref_key:"formDataRef",ref:e,"label-width":"80px",onSubmit:r[2]||(r[2]=Y(()=>{},["prevent"]))},{default:d(()=>[i(M,{label:"新密码",prop:"password"},{default:d(()=>[i(m,{type:"password",size:"large",placeholder:"请输入密码",modelValue:f.value.password,"onUpdate:modelValue":r[0]||(r[0]=l=>f.value.password=l),"show-password":""},{prefix:d(()=>[ge]),_:1},8,["modelValue"])]),_:1}),i(M,{label:"确认密码",prop:"rePassword"},{default:d(()=>[i(m,{type:"password",size:"large",placeholder:"请再次输入密码",modelValue:f.value.rePassword,"onUpdate:modelValue":r[1]||(r[1]=l=>f.value.rePassword=l),"show-password":""},{prefix:d(()=>[ke]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title","buttons"])])}}};const be=h=>(ee("data-v-c4b41b7f"),h=h(),te(),h),Ce={class:"uploader-panel"},Se=be(()=>t("div",{class:"uploader-title"},[t("span",null,"上传任务"),t("span",{class:"tips"},"（仅展示本次上传任务）")],-1)),$e={class:"file-list"},xe={class:"file-item"},Ue={class:"upload-panel"},Pe={class:"file-name"},Fe={class:"progress"},Ie={class:"upload-status"},Re={key:0,class:"upload-info"},Ve={class:"op"},Ae={class:"op-btn"},ze={key:0},De={key:0},q=1024*512,Ne={__name:"Uploader",emits:["uploadCallback"],setup(h,{expose:w,emit:U}){const{proxy:F}=O(),f={upload:"/file/uploadFile"},e={emptyfile:{value:"emptyfile",desc:"文件为空",color:"#F75000",icon:"close"},fail:{value:"fail",desc:"上传失败",color:"#F75000",icon:"close"},init:{value:"init",desc:"解析中",color:"#e6a23c",icon:"clock"},uploading:{value:"uploading",desc:"上传中",color:"#409eff",icon:"upload"},upload_finish:{value:"upload_finish",desc:"上传完成",color:"#67c23a",icon:"ok"},upload_seconds:{value:"upload_seconds",desc:"秒传",color:"#67c23a",icon:"ok"}},g=_([]),R=_([]);w({addFile:async(o,l)=>{const a={file:o,uid:o.uid,md5Progress:0,md5:null,fileName:o.name,status:e.init.value,uploadSize:0,totalSize:o.size,uploadProgress:0,pause:!1,chunkIndex:0,filePid:l,errorMsg:null};if(g.value.unshift(a),a.totalSize==0){a.status=e.emptyfile.value;return}let S=await M(a);S!=null&&m(S)}});const V=o=>{let l=A(o);l.pause=!1,m(o,l.chunkIndex)},L=o=>{let l=A(o);l.pause=!0},u=(o,l)=>{R.value.push(o),g.value.splice(l,1)},r=U,m=async(o,l)=>{l=l||0;let a=A(o);const S=a.file,k=a.totalSize,s=Math.ceil(k/q);for(let $=l;$<s;$++){let x=R.value.indexOf(o);if(x!=-1){R.value.splice(x,1);break}if(a=A(o),a.pause)break;let y=$*q,c=y+q>=k?k:y+q,b=S.slice(y,c),I=await F.Request({url:f.upload,showLoading:!1,dataType:"file",params:{file:b,fileName:S.name,fileMd5:a.md5,chunkIndex:$,chunks:s,fileId:a.fileId,filePid:a.filePid},showError:!1,errorCallback:z=>{a.status=e.fail.value,a.errorMsg=z},uploadProgressCallback:z=>{let B=z.loaded;B>k&&(B=k),a.uploadSize=$*q+B,a.uploadProgress=Math.floor(a.uploadSize/k*100)}});if(I==null)break;if(a.fileId=I.data.fileId,a.status=e[I.data.status].value,a.chunkIndex=$,I.data.status==e.upload_seconds.value||I.data.status==e.upload_finish.value){a.uploadProgress=100,r("uploadCallback");break}}},M=o=>{let l=o.file,a=File.prototype.slice||File.prototype.mozSlice||File.prototype.webkitSlice,S=Math.ceil(l.size/q),k=0,s=new ce.ArrayBuffer,$=new FileReader;new Date().getTime();let x=()=>{let y=k*q,c=y+q>=l.size?l.size:y+q;$.readAsArrayBuffer(a.call(l,y,c))};return x(),new Promise((y,c)=>{let b=A(l.uid);$.onload=I=>{if(s.append(I.target.result),k++,k<S){let z=Math.floor(k/S*100);b.md5Progress=z,x()}else{let z=s.end();s.destroy(),b.md5Progress=100,b.status=e.uploading.value,b.md5=z,y(o.uid)}},$.onerror=()=>{b.md5Progress=-1,b.status=e.fail.value,y(o.uid)}}).catch(y=>null)},A=o=>g.value.find(a=>a.file.uid===o);return(o,l)=>{const a=v("el-progress"),S=v("icon"),k=v("NoData");return n(),p("div",Ce,[Se,t("div",$e,[(n(!0),p(E,null,H(g.value,(s,$)=>(n(),p("div",xe,[t("div",Ue,[t("div",Pe,D(s.fileName),1),t("div",Fe,[s.status==e.uploading.value||s.status==e.upload_seconds.value||s.status==e.upload_finish.value?(n(),T(a,{key:0,percentage:s.uploadProgress},null,8,["percentage"])):N("",!0)]),t("div",Ie,[t("span",{class:j(["iconfont","icon-"+e[s.status].icon]),style:X({color:e[s.status].color})},null,6),t("span",{class:"status",style:X({color:e[s.status].color})},D(s.status=="fail"?s.errorMsg:e[s.status].desc),5),s.status==e.uploading.value?(n(),p("span",Re,D(J(F).Utils.size2Str(s.uploadSize))+"/"+D(J(F).Utils.size2Str(s.totalSize)),1)):N("",!0)])]),t("div",Ve,[s.status==e.init.value?(n(),T(a,{key:0,type:"circle",width:50,percentage:s.md5Progress},null,8,["percentage"])):N("",!0),t("div",Ae,[s.status===e.uploading.value?(n(),p("span",ze,[s.pause?(n(),T(S,{key:0,width:28,class:"btn-item",iconName:"upload",title:"上传",onClick:x=>V(s.uid)},null,8,["onClick"])):(n(),T(S,{key:1,width:28,class:"btn-item",iconName:"pause",title:"暂停",onClick:x=>L(s.uid)},null,8,["onClick"]))])):N("",!0),s.status!=e.init.value&&s.status!=e.upload_finish.value&&s.status!=e.upload_seconds.value?(n(),T(S,{key:1,width:28,class:"del btn-item",iconName:"del",title:"删除",onClick:x=>u(s.uid,$)},null,8,["onClick"])):N("",!0),s.status==e.upload_finish.value||s.status==e.upload_seconds.value?(n(),T(S,{key:2,width:28,class:"clean btn-item",iconName:"clean",title:"清除",onClick:x=>u(s.uid,$)},null,8,["onClick"])):N("",!0)])])]))),256)),g.value.length==0?(n(),p("div",De,[i(k,{msg:"暂无上传任务"})])):N("",!0)])])}}},Me=se(Ne,[["__scopeId","data-v-c4b41b7f"]]);const W=h=>(ee("data-v-832ae474"),h=h(),te(),h),qe={class:"framework"},Le={class:"header"},Be=W(()=>t("div",{class:"logo"},[t("span",{class:"iconfont icon-pan"}),t("span",{class:"name"},"Easy云盘")],-1)),Te={class:"right-panel"},je=W(()=>t("span",{class:"iconfont icon-transfer"},null,-1)),Ee={class:"user-info"},Ge={class:"avatar"},Oe={class:"nick-name"},Je={class:"body"},He={class:"left-sider"},Ke={class:"menu-list"},Qe=["onClick"],We={class:"text"},Xe={class:"menu-sub-list"},Ye=["onClick"],Ze={class:"text"},et={key:0,class:"tips"},tt={class:"space-info"},st=W(()=>t("div",null,"空间使用",-1)),at={class:"percent"},ot={class:"space-use"},lt={class:"use"},nt={class:"body-content"},rt={__name:"Framework",setup(h){const{proxy:w}=O(),U=K(),F=Q(),f={getUseSpace:"/getUseSpace",logout:"/logout"},e=_(!1),g=_(),R=c=>{const{file:b,filePid:I}=c;e.value=!0,g.value.addFile(b,I)},P=_(),V=()=>{Z(()=>{P.value.reload(),y()})},L=_(0),u=_(w.VueCookies.get("userInfo")),r=[{icon:"cloude",name:"首页",menuCode:"main",path:"/main/all",allShow:!0,children:[{icon:"all",name:"全部",category:"all",path:"/main/all"},{icon:"video",name:"视频",category:"video",path:"/main/video"},{icon:"music",name:"音频",category:"music",path:"/main/music"},{icon:"image",name:"图片",category:"image",path:"/main/image"},{icon:"doc",name:"文档",category:"doc",path:"/main/doc"},{icon:"more",name:"其他",category:"others",path:"/main/others"}]},{path:"/myshare",icon:"share",name:"分享",menuCode:"share",allShow:!0,children:[{name:"分享记录",path:"/myshare"}]},{path:"/recycle",icon:"del",name:"回收站",menuCode:"recycle",tips:"回收站为你保存10天内删除的文件",allShow:!0,children:[{name:"删除的文件",path:"/recycle"}]},{path:"/settings/fileList",icon:"settings",name:"设置",menuCode:"settings",allShow:!1,children:[{name:"用户文件",path:"/settings/fileList"},{name:"用户管理",path:"/settings/userList"},{path:"/settings/sysSetting",name:"系统设置"}]}],m=_({}),M=_(),A=c=>{!c.path||c.menuCode==m.value.menuCode||U.push(c.path)},o=(c,b)=>{const I=r.find(z=>z.menuCode===c);m.value=I,M.value=b};ie(()=>F,(c,b)=>{c.meta.menuCode&&o(c.meta.menuCode,c.path)},{immediate:!0,deep:!0});const l=_(),a=()=>{l.value.show(u.value)},S=()=>{u.value=w.VueCookies.get("userInfo"),L.value=new Date().getTime()},k=_(),s=()=>{k.value.show()},$=()=>{w.Confirm("你确定要删除退出吗",async()=>{await w.Request({url:f.logout})&&(w.VueCookies.remove("userInfo"),U.push("/login"))})},x=_({useSpace:0,totalSpace:1}),y=async()=>{let c=await w.Request({url:f.getUseSpace,showLoading:!1});c&&(x.value=c.data)};return y(),(c,b)=>{const I=v("el-popover"),z=v("Avatar"),B=v("el-dropdown-item"),ae=v("el-dropdown-menu"),oe=v("el-dropdown"),le=v("el-progress"),ne=v("router-view");return n(),p("div",qe,[t("div",Le,[Be,t("div",Te,[i(I,{width:800,trigger:"click",visible:e.value,"onUpdate:visible":b[0]||(b[0]=C=>e.value=C),offset:20,transition:"none","hide-after":0,"popper-style":{padding:"0px"}},{reference:d(()=>[je]),default:d(()=>[i(Me,{ref_key:"uploaderRef",ref:g,onUploadCallback:V},null,512)]),_:1},8,["visible"]),i(oe,null,{dropdown:d(()=>[i(ae,null,{default:d(()=>[i(B,{onClick:a},{default:d(()=>[G(" 修改头像 ")]),_:1}),i(B,{onClick:s},{default:d(()=>[G(" 修改密码 ")]),_:1}),i(B,{onClick:$},{default:d(()=>[G(" 退出 ")]),_:1})]),_:1})]),default:d(()=>[t("div",Ee,[t("div",Ge,[i(z,{userId:u.value.userId,avatar:u.value.avatar,timestamp:L.value,width:46},null,8,["userId","avatar","timestamp"])]),t("span",Oe,D(u.value.nickName),1)])]),_:1})])]),t("div",Je,[t("div",He,[t("div",Ke,[(n(),p(E,null,H(r,C=>(n(),p(E,null,[C.allShow||!C.allShow&&u.value.admin?(n(),p("div",{key:0,onClick:re=>A(C),class:j(["menu-item",C.menuCode==m.value.menuCode?"active":""])},[t("div",{class:j(["iconfont","icon-"+C.icon])},null,2),t("div",We,D(C.name),1)],10,Qe)):N("",!0)],64))),64))]),t("div",Xe,[(n(!0),p(E,null,H(m.value.children,C=>(n(),p("div",{onClick:re=>A(C),class:j(["menu-item-sub",M.value==C.path?"active":""])},[C.icon?(n(),p("span",{key:0,class:j(["iconfont","icon-"+C.icon])},null,2)):N("",!0),t("span",Ze,D(C.name),1)],10,Ye))),256)),m.value&&m.value.tips?(n(),p("div",et,D(m.value.tips),1)):N("",!0),t("div",tt,[st,t("div",at,[i(le,{percentage:Math.floor(x.value.useSpace/x.value.totalSpace*1e4)/100,color:"#409eff"},null,8,["percentage"])]),t("div",ot,[t("div",lt,D(J(w).Utils.size2Str(x.value.useSpace))+"/ "+D(J(w).Utils.size2Str(x.value.totalSpace)),1),t("div",{class:"iconfont icon-refresh",onClick:y})])])])]),t("div",nt,[i(ne,null,{default:d(({Component:C})=>[(n(),T(ue(C),{onAddFile:R,ref_key:"routerViewRef",ref:P,onReload:y},null,544))]),_:1})])]),i(we,{ref_key:"updateAvatarRef",ref:l,onUpdateAvatar:S},null,512),i(ye,{ref_key:"updatePasswordRef",ref:k},null,512)])}}},Nt=se(rt,[["__scopeId","data-v-832ae474"]]);export{Nt as default};
